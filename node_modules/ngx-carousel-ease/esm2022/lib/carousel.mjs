export class Carousel {
    constructor(carousel, maxWidthCarousel, slideToShow, slideWidth, slideMaxWidth, gap, responsive, loop) {
        this.carousel = carousel;
        this.maxWidthCarousel = maxWidthCarousel;
        this.slideToShow = slideToShow;
        this.slideWidth = slideWidth;
        this.slideMaxWidth = slideMaxWidth;
        this.gap = gap;
        this.responsive = responsive;
        this.loop = loop;
        this.arrayNumberDots = [];
        this.maxScrollableContent = 0;
        this.totalSlides = 0;
        this.initialSlideToShow = 1;
        this.paddingCarousel = 0;
        this.arrayOfSlides = [];
        this.init();
    }
    init() {
        this.paddingCarousel = this.getPaddingCarousel();
        this.initialSlideToShow = this.slideToShow;
        this.slidesContainer = this.selectSlidesContainer();
        this.slides = this.selectSlides();
        this.arrayOfSlides = this.slidesToArray();
        this.totalSlides = this.slides.length;
        this.originalSlideWidth = this.slideWidth;
        this.setWidthSlides();
        this.setMaxWidthCarousel();
        this.updateProperties();
        this.slidesContainer.style.gap = `${this.gap}px`;
        this.setDraggableImgToFalse();
    }
    /**
     * Set the slide width and max width
     * NB: In responsive mode, width is automatically adapted through the setAutoColumnSlideContainer() method.
     *
     */
    setWidthSlides() {
        for (const slide of this.slides) {
            slide.style.maxWidth = `${this.slideMaxWidth}px`;
            slide.style.width = '100%';
            slide.style.userSelect = 'none';
            if (!this.responsive) {
                slide.style.width = `${this.slideWidth}px`;
            }
        }
    }
    /**
     * Update carousel properties
     * Occurs at start and at resizing.
     */
    updateProperties() {
        this.carouselWidth = this.carousel.clientWidth;
        if (this.responsive) {
            this.updateSlideToShowResponsive();
            this.setAutoColumnSlideContainer();
        }
        else {
            this.updateSlideToShowNotResponsive();
        }
        this.numberDots = this.setNumberDots();
        this.arrayNumberDots = [...Array(this.numberDots).keys()];
        this.slideWidthWithGap = this.slideWidth + this.gap;
        this.setWidthSlideContainer();
        this.maxScrollableContent = this.getMaxScroll();
    }
    /**
     * Update slide to show (responsive mode)
     * Computes the number of slide fitting
     */
    updateSlideToShowResponsive() {
        const slideWidthPlusGap = this.originalSlideWidth + this.gap;
        const referenceWidth = Math.min(this.carouselWidth, this.maxWidthCarousel || Infinity, window.innerWidth);
        const slideFitting = Math.floor(referenceWidth / slideWidthPlusGap) || 1;
        this.determineSlideToShow(slideFitting);
    }
    /**
     * Determine slide to show
     * Useful to compute the slide displayed on screen and for the slider class.
     * In not responsive mode, the maximum slides to show is determined by the maximum available space and the width of the slide set by the user.
     */
    determineSlideToShow(slideFitting) {
        const maxSlidesToShow = this.responsive
            ? this.initialSlideToShow
            : this.totalSlides;
        this.slideToShow = Math.min(slideFitting, maxSlidesToShow);
    }
    /**
     * Update slide to show (not responsive mode)
     * Computes the number of slide fitting. The number of slides to be shown are determined by the number of slides fitting within its container.
     */
    updateSlideToShowNotResponsive() {
        const slideWidthPlusGap = this.slideWidth + this.gap;
        const referenceWidth = Math.min(this.carouselWidth, this.maxWidthCarousel || Infinity, window.innerWidth);
        const numberOfSlidesComputed = Math.floor(referenceWidth / slideWidthPlusGap) || 1;
        const slideFitting = Math.min(numberOfSlidesComputed, this.totalSlides);
        this.determineSlideToShow(slideFitting);
    }
    getPaddingCarousel() {
        const computedStyle = window.getComputedStyle(this.carousel);
        const paddingLeft = computedStyle.getPropertyValue('padding-left');
        const paddingRight = computedStyle.getPropertyValue('padding-right');
        return parseFloat(paddingLeft) + parseFloat(paddingRight);
    }
    setMaxWidthCarousel() {
        this.carousel.style.maxWidth = `${this.maxWidthCarousel}px`;
    }
    /**
     * Set the with of a slide, responsive mode
     * There are [n cards - 1] gaps (3 cards, 2 gaps)
     */
    setAutoColumnSlideContainer() {
        const windowWidth = this.carouselWidth -
            this.paddingCarousel -
            (this.slideToShow - 1) * this.gap;
        const widthPerSlide = windowWidth / this.slideToShow;
        this.slidesContainer.style.gridAutoColumns = `${widthPerSlide}px`;
        this.slideWidth = widthPerSlide;
    }
    /**
     * Define the slide container width
     * Make non visible gaps of non visible cards scrollable and is used to compute the maxScrollableContent (strechingEffect)
     */
    setWidthSlideContainer() {
        this.widthSlideContainer =
            this.selectSlides().length * this.slideWidthWithGap - this.gap;
        this.slidesContainer.style.width = `${this.widthSlideContainer}px`;
    }
    selectSlides() {
        return this.carousel.querySelectorAll('.carousel-slide');
    }
    slidesToArray() {
        return Array.from(this.slides);
    }
    selectSlidesContainer() {
        return this.carousel.querySelector('.slides-container');
    }
    /**
     * Set number of dots
     * If infinite mode, one more window than normal mode.
     */
    setNumberDots() {
        if (this.loop) {
            return this.totalSlides === this.slideToShow ? 1 : this.totalSlides;
        }
        return this.slideToShow > 1
            ? this.totalSlides - this.slideToShow + 1
            : this.totalSlides;
    }
    /**
     * Get the max scrollable content
     * Useful for the streching effect (not infinite mode), end of the slides
     */
    getMaxScroll() {
        return (this.numberDots - 1) * this.slideWidthWithGap;
    }
    setDraggableImgToFalse() {
        const images = this.slidesContainer.querySelectorAll('img');
        images?.forEach((image) => {
            image.setAttribute('draggable', 'false');
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9jYXJvdXNlbC9zcmMvbGliL2Nhcm91c2VsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxRQUFRO0lBZW5CLFlBQ21CLFFBQXdCLEVBQ3hCLGdCQUF3QixFQUNsQyxXQUFtQixFQUNuQixVQUFrQixFQUNULGFBQXFCLEVBQ3JCLEdBQVcsRUFDVixVQUFtQixFQUNuQixJQUFhO1FBUGIsYUFBUSxHQUFSLFFBQVEsQ0FBZ0I7UUFDeEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFRO1FBQ2xDLGdCQUFXLEdBQVgsV0FBVyxDQUFRO1FBQ25CLGVBQVUsR0FBVixVQUFVLENBQVE7UUFDVCxrQkFBYSxHQUFiLGFBQWEsQ0FBUTtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFRO1FBQ1YsZUFBVSxHQUFWLFVBQVUsQ0FBUztRQUNuQixTQUFJLEdBQUosSUFBSSxDQUFTO1FBbEJoQyxvQkFBZSxHQUFhLEVBQUUsQ0FBQztRQUUvQix5QkFBb0IsR0FBRyxDQUFDLENBQUM7UUFDekIsZ0JBQVcsR0FBRyxDQUFDLENBQUM7UUFDaEIsdUJBQWtCLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLG9CQUFlLEdBQUcsQ0FBQyxDQUFDO1FBR3BCLGtCQUFhLEdBQXFCLEVBQUUsQ0FBQztRQVluQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQsSUFBSTtRQUNGLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDakQsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDM0MsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNsQyxJQUFJ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Q0FBQyxXQUFXLEdBQUcsQ0FBQztZQUN6QyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUN2QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsWUFBWTtRQUNWLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztJQUN4RCxDQUFDO0lBRUQsc0JBQXNCO1FBQ3BCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUQsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ3hCLEtBQUssQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIENhcm91c2VsIHtcclxuICBzbGlkZXMhOiBOb2RlTGlzdE9mPEhUTUxEaXZFbGVtZW50PjtcclxuICBvcmlnaW5hbFNsaWRlV2lkdGghOiBudW1iZXI7XHJcbiAgc2xpZGVXaWR0aFdpdGhHYXAhOiBudW1iZXI7XHJcbiAgbnVtYmVyRG90cyE6IG51bWJlcjtcclxuICBhcnJheU51bWJlckRvdHM6IG51bWJlcltdID0gW107XHJcbiAgc2xpZGVzQ29udGFpbmVyITogSFRNTERpdkVsZW1lbnQ7XHJcbiAgbWF4U2Nyb2xsYWJsZUNvbnRlbnQgPSAwO1xyXG4gIHRvdGFsU2xpZGVzID0gMDtcclxuICBpbml0aWFsU2xpZGVUb1Nob3cgPSAxO1xyXG4gIHBhZGRpbmdDYXJvdXNlbCA9IDA7XHJcbiAgY2Fyb3VzZWxXaWR0aCE6IG51bWJlcjtcclxuICB3aWR0aFNsaWRlQ29udGFpbmVyITogbnVtYmVyO1xyXG4gIGFycmF5T2ZTbGlkZXM6IEhUTUxEaXZFbGVtZW50W10gPSBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNhcm91c2VsOiBIVE1MRGl2RWxlbWVudCxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWF4V2lkdGhDYXJvdXNlbDogbnVtYmVyLFxyXG4gICAgcHVibGljIHNsaWRlVG9TaG93OiBudW1iZXIsXHJcbiAgICBwdWJsaWMgc2xpZGVXaWR0aDogbnVtYmVyLFxyXG4gICAgcHVibGljIHJlYWRvbmx5IHNsaWRlTWF4V2lkdGg6IG51bWJlcixcclxuICAgIHB1YmxpYyByZWFkb25seSBnYXA6IG51bWJlcixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVzcG9uc2l2ZTogYm9vbGVhbixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgbG9vcDogYm9vbGVhblxyXG4gICkge1xyXG4gICAgdGhpcy5pbml0KCk7XHJcbiAgfVxyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy5wYWRkaW5nQ2Fyb3VzZWwgPSB0aGlzLmdldFBhZGRpbmdDYXJvdXNlbCgpO1xyXG4gICAgdGhpcy5pbml0aWFsU2xpZGVUb1Nob3cgPSB0aGlzLnNsaWRlVG9TaG93O1xyXG4gICAgdGhpcy5zbGlkZXNDb250YWluZXIgPSB0aGlzLnNlbGVjdFNsaWRlc0NvbnRhaW5lcigpO1xyXG4gICAgdGhpcy5zbGlkZXMgPSB0aGlzLnNlbGVjdFNsaWRlcygpO1xyXG4gICAgdGhpcy5hcnJheU9mU2xpZGVzID0gdGhpcy5zbGlkZXNUb0FycmF5KCk7XHJcbiAgICB0aGlzLnRvdGFsU2xpZGVzID0gdGhpcy5zbGlkZXMubGVuZ3RoO1xyXG4gICAgdGhpcy5vcmlnaW5hbFNsaWRlV2lkdGggPSB0aGlzLnNsaWRlV2lkdGg7XHJcbiAgICB0aGlzLnNldFdpZHRoU2xpZGVzKCk7XHJcbiAgICB0aGlzLnNldE1heFdpZHRoQ2Fyb3VzZWwoKTtcclxuICAgIHRoaXMudXBkYXRlUHJvcGVydGllcygpO1xyXG4gICAgdGhpcy5zbGlkZXNDb250YWluZXIuc3R5bGUuZ2FwID0gYCR7dGhpcy5nYXB9cHhgO1xyXG4gICAgdGhpcy5zZXREcmFnZ2FibGVJbWdUb0ZhbHNlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHNsaWRlIHdpZHRoIGFuZCBtYXggd2lkdGhcclxuICAgKiBOQjogSW4gcmVzcG9uc2l2ZSBtb2RlLCB3aWR0aCBpcyBhdXRvbWF0aWNhbGx5IGFkYXB0ZWQgdGhyb3VnaCB0aGUgc2V0QXV0b0NvbHVtblNsaWRlQ29udGFpbmVyKCkgbWV0aG9kLlxyXG4gICAqXHJcbiAgICovXHJcbiAgc2V0V2lkdGhTbGlkZXMoKSB7XHJcbiAgICBmb3IgKGNvbnN0IHNsaWRlIG9mIHRoaXMuc2xpZGVzKSB7XHJcbiAgICAgIHNsaWRlLnN0eWxlLm1heFdpZHRoID0gYCR7dGhpcy5zbGlkZU1heFdpZHRofXB4YDtcclxuICAgICAgc2xpZGUuc3R5bGUud2lkdGggPSAnMTAwJSc7XHJcbiAgICAgIHNsaWRlLnN0eWxlLnVzZXJTZWxlY3QgPSAnbm9uZSc7XHJcblxyXG4gICAgICBpZiAoIXRoaXMucmVzcG9uc2l2ZSkge1xyXG4gICAgICAgIHNsaWRlLnN0eWxlLndpZHRoID0gYCR7dGhpcy5zbGlkZVdpZHRofXB4YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIGNhcm91c2VsIHByb3BlcnRpZXNcclxuICAgKiBPY2N1cnMgYXQgc3RhcnQgYW5kIGF0IHJlc2l6aW5nLlxyXG4gICAqL1xyXG4gIHVwZGF0ZVByb3BlcnRpZXMoKSB7XHJcbiAgICB0aGlzLmNhcm91c2VsV2lkdGggPSB0aGlzLmNhcm91c2VsLmNsaWVudFdpZHRoO1xyXG4gICAgaWYgKHRoaXMucmVzcG9uc2l2ZSkge1xyXG4gICAgICB0aGlzLnVwZGF0ZVNsaWRlVG9TaG93UmVzcG9uc2l2ZSgpO1xyXG4gICAgICB0aGlzLnNldEF1dG9Db2x1bW5TbGlkZUNvbnRhaW5lcigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy51cGRhdGVTbGlkZVRvU2hvd05vdFJlc3BvbnNpdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm51bWJlckRvdHMgPSB0aGlzLnNldE51bWJlckRvdHMoKTtcclxuICAgIHRoaXMuYXJyYXlOdW1iZXJEb3RzID0gWy4uLkFycmF5KHRoaXMubnVtYmVyRG90cykua2V5cygpXTtcclxuXHJcbiAgICB0aGlzLnNsaWRlV2lkdGhXaXRoR2FwID0gdGhpcy5zbGlkZVdpZHRoICsgdGhpcy5nYXA7XHJcbiAgICB0aGlzLnNldFdpZHRoU2xpZGVDb250YWluZXIoKTtcclxuICAgIHRoaXMubWF4U2Nyb2xsYWJsZUNvbnRlbnQgPSB0aGlzLmdldE1heFNjcm9sbCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHNsaWRlIHRvIHNob3cgKHJlc3BvbnNpdmUgbW9kZSlcclxuICAgKiBDb21wdXRlcyB0aGUgbnVtYmVyIG9mIHNsaWRlIGZpdHRpbmdcclxuICAgKi9cclxuICB1cGRhdGVTbGlkZVRvU2hvd1Jlc3BvbnNpdmUoKSB7XHJcbiAgICBjb25zdCBzbGlkZVdpZHRoUGx1c0dhcCA9IHRoaXMub3JpZ2luYWxTbGlkZVdpZHRoICsgdGhpcy5nYXA7XHJcblxyXG4gICAgY29uc3QgcmVmZXJlbmNlV2lkdGggPSBNYXRoLm1pbihcclxuICAgICAgdGhpcy5jYXJvdXNlbFdpZHRoLFxyXG4gICAgICB0aGlzLm1heFdpZHRoQ2Fyb3VzZWwgfHwgSW5maW5pdHksXHJcbiAgICAgIHdpbmRvdy5pbm5lcldpZHRoXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHNsaWRlRml0dGluZyA9IE1hdGguZmxvb3IocmVmZXJlbmNlV2lkdGggLyBzbGlkZVdpZHRoUGx1c0dhcCkgfHwgMTtcclxuXHJcbiAgICB0aGlzLmRldGVybWluZVNsaWRlVG9TaG93KHNsaWRlRml0dGluZyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmUgc2xpZGUgdG8gc2hvd1xyXG4gICAqIFVzZWZ1bCB0byBjb21wdXRlIHRoZSBzbGlkZSBkaXNwbGF5ZWQgb24gc2NyZWVuIGFuZCBmb3IgdGhlIHNsaWRlciBjbGFzcy5cclxuICAgKiBJbiBub3QgcmVzcG9uc2l2ZSBtb2RlLCB0aGUgbWF4aW11bSBzbGlkZXMgdG8gc2hvdyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSBtYXhpbXVtIGF2YWlsYWJsZSBzcGFjZSBhbmQgdGhlIHdpZHRoIG9mIHRoZSBzbGlkZSBzZXQgYnkgdGhlIHVzZXIuXHJcbiAgICovXHJcbiAgZGV0ZXJtaW5lU2xpZGVUb1Nob3coc2xpZGVGaXR0aW5nOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG1heFNsaWRlc1RvU2hvdyA9IHRoaXMucmVzcG9uc2l2ZVxyXG4gICAgICA/IHRoaXMuaW5pdGlhbFNsaWRlVG9TaG93XHJcbiAgICAgIDogdGhpcy50b3RhbFNsaWRlcztcclxuXHJcbiAgICB0aGlzLnNsaWRlVG9TaG93ID0gTWF0aC5taW4oc2xpZGVGaXR0aW5nLCBtYXhTbGlkZXNUb1Nob3cpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHNsaWRlIHRvIHNob3cgKG5vdCByZXNwb25zaXZlIG1vZGUpXHJcbiAgICogQ29tcHV0ZXMgdGhlIG51bWJlciBvZiBzbGlkZSBmaXR0aW5nLiBUaGUgbnVtYmVyIG9mIHNsaWRlcyB0byBiZSBzaG93biBhcmUgZGV0ZXJtaW5lZCBieSB0aGUgbnVtYmVyIG9mIHNsaWRlcyBmaXR0aW5nIHdpdGhpbiBpdHMgY29udGFpbmVyLlxyXG4gICAqL1xyXG4gIHVwZGF0ZVNsaWRlVG9TaG93Tm90UmVzcG9uc2l2ZSgpIHtcclxuICAgIGNvbnN0IHNsaWRlV2lkdGhQbHVzR2FwID0gdGhpcy5zbGlkZVdpZHRoICsgdGhpcy5nYXA7XHJcblxyXG4gICAgY29uc3QgcmVmZXJlbmNlV2lkdGggPSBNYXRoLm1pbihcclxuICAgICAgdGhpcy5jYXJvdXNlbFdpZHRoLFxyXG4gICAgICB0aGlzLm1heFdpZHRoQ2Fyb3VzZWwgfHwgSW5maW5pdHksXHJcbiAgICAgIHdpbmRvdy5pbm5lcldpZHRoXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IG51bWJlck9mU2xpZGVzQ29tcHV0ZWQgPVxyXG4gICAgICBNYXRoLmZsb29yKHJlZmVyZW5jZVdpZHRoIC8gc2xpZGVXaWR0aFBsdXNHYXApIHx8IDE7XHJcbiAgICBjb25zdCBzbGlkZUZpdHRpbmcgPSBNYXRoLm1pbihudW1iZXJPZlNsaWRlc0NvbXB1dGVkLCB0aGlzLnRvdGFsU2xpZGVzKTtcclxuXHJcbiAgICB0aGlzLmRldGVybWluZVNsaWRlVG9TaG93KHNsaWRlRml0dGluZyk7XHJcbiAgfVxyXG5cclxuICBnZXRQYWRkaW5nQ2Fyb3VzZWwoKSB7XHJcbiAgICBjb25zdCBjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5jYXJvdXNlbCk7XHJcbiAgICBjb25zdCBwYWRkaW5nTGVmdCA9IGNvbXB1dGVkU3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgncGFkZGluZy1sZWZ0Jyk7XHJcbiAgICBjb25zdCBwYWRkaW5nUmlnaHQgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ3BhZGRpbmctcmlnaHQnKTtcclxuXHJcbiAgICByZXR1cm4gcGFyc2VGbG9hdChwYWRkaW5nTGVmdCkgKyBwYXJzZUZsb2F0KHBhZGRpbmdSaWdodCk7XHJcbiAgfVxyXG5cclxuICBzZXRNYXhXaWR0aENhcm91c2VsKCkge1xyXG4gICAgdGhpcy5jYXJvdXNlbC5zdHlsZS5tYXhXaWR0aCA9IGAke3RoaXMubWF4V2lkdGhDYXJvdXNlbH1weGA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgdGhlIHdpdGggb2YgYSBzbGlkZSwgcmVzcG9uc2l2ZSBtb2RlXHJcbiAgICogVGhlcmUgYXJlIFtuIGNhcmRzIC0gMV0gZ2FwcyAoMyBjYXJkcywgMiBnYXBzKVxyXG4gICAqL1xyXG4gIHNldEF1dG9Db2x1bW5TbGlkZUNvbnRhaW5lcigpIHtcclxuICAgIGNvbnN0IHdpbmRvd1dpZHRoID1cclxuICAgICAgdGhpcy5jYXJvdXNlbFdpZHRoIC1cclxuICAgICAgdGhpcy5wYWRkaW5nQ2Fyb3VzZWwgLVxyXG4gICAgICAodGhpcy5zbGlkZVRvU2hvdyAtIDEpICogdGhpcy5nYXA7XHJcblxyXG4gICAgY29uc3Qgd2lkdGhQZXJTbGlkZSA9IHdpbmRvd1dpZHRoIC8gdGhpcy5zbGlkZVRvU2hvdztcclxuICAgIHRoaXMuc2xpZGVzQ29udGFpbmVyLnN0eWxlLmdyaWRBdXRvQ29sdW1ucyA9IGAke3dpZHRoUGVyU2xpZGV9cHhgO1xyXG5cclxuICAgIHRoaXMuc2xpZGVXaWR0aCA9IHdpZHRoUGVyU2xpZGU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWZpbmUgdGhlIHNsaWRlIGNvbnRhaW5lciB3aWR0aFxyXG4gICAqIE1ha2Ugbm9uIHZpc2libGUgZ2FwcyBvZiBub24gdmlzaWJsZSBjYXJkcyBzY3JvbGxhYmxlIGFuZCBpcyB1c2VkIHRvIGNvbXB1dGUgdGhlIG1heFNjcm9sbGFibGVDb250ZW50IChzdHJlY2hpbmdFZmZlY3QpXHJcbiAgICovXHJcbiAgc2V0V2lkdGhTbGlkZUNvbnRhaW5lcigpIHtcclxuICAgIHRoaXMud2lkdGhTbGlkZUNvbnRhaW5lciA9XHJcbiAgICAgIHRoaXMuc2VsZWN0U2xpZGVzKCkubGVuZ3RoICogdGhpcy5zbGlkZVdpZHRoV2l0aEdhcCAtIHRoaXMuZ2FwO1xyXG4gICAgdGhpcy5zbGlkZXNDb250YWluZXIuc3R5bGUud2lkdGggPSBgJHt0aGlzLndpZHRoU2xpZGVDb250YWluZXJ9cHhgO1xyXG4gIH1cclxuXHJcbiAgc2VsZWN0U2xpZGVzKCk6IE5vZGVMaXN0T2Y8SFRNTERpdkVsZW1lbnQ+IHtcclxuICAgIHJldHVybiB0aGlzLmNhcm91c2VsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jYXJvdXNlbC1zbGlkZScpO1xyXG4gIH1cclxuXHJcbiAgc2xpZGVzVG9BcnJheSgpIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuc2xpZGVzKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdFNsaWRlc0NvbnRhaW5lcigpIHtcclxuICAgIHJldHVybiB0aGlzLmNhcm91c2VsLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXMtY29udGFpbmVyJykgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgbnVtYmVyIG9mIGRvdHNcclxuICAgKiBJZiBpbmZpbml0ZSBtb2RlLCBvbmUgbW9yZSB3aW5kb3cgdGhhbiBub3JtYWwgbW9kZS5cclxuICAgKi9cclxuICBzZXROdW1iZXJEb3RzKCkge1xyXG4gICAgaWYgKHRoaXMubG9vcCkge1xyXG4gICAgICByZXR1cm4gdGhpcy50b3RhbFNsaWRlcyA9PT0gdGhpcy5zbGlkZVRvU2hvdyA/IDEgOiB0aGlzLnRvdGFsU2xpZGVzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnNsaWRlVG9TaG93ID4gMVxyXG4gICAgICA/IHRoaXMudG90YWxTbGlkZXMgLSB0aGlzLnNsaWRlVG9TaG93ICsgMVxyXG4gICAgICA6IHRoaXMudG90YWxTbGlkZXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIG1heCBzY3JvbGxhYmxlIGNvbnRlbnRcclxuICAgKiBVc2VmdWwgZm9yIHRoZSBzdHJlY2hpbmcgZWZmZWN0IChub3QgaW5maW5pdGUgbW9kZSksIGVuZCBvZiB0aGUgc2xpZGVzXHJcbiAgICovXHJcbiAgZ2V0TWF4U2Nyb2xsKCkge1xyXG4gICAgcmV0dXJuICh0aGlzLm51bWJlckRvdHMgLSAxKSAqIHRoaXMuc2xpZGVXaWR0aFdpdGhHYXA7XHJcbiAgfVxyXG5cclxuICBzZXREcmFnZ2FibGVJbWdUb0ZhbHNlKCkge1xyXG4gICAgY29uc3QgaW1hZ2VzID0gdGhpcy5zbGlkZXNDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7XHJcbiAgICBpbWFnZXM/LmZvckVhY2goKGltYWdlKSA9PiB7XHJcbiAgICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ2ZhbHNlJyk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19